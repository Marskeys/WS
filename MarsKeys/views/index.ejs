<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mars Keys — Counter to Welcome</title>

  <!-- Google Font: Michroma -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Michroma&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0e1016; 
      --text:#eef2f8; 
      --muted:#9aa3b2;
      --fill:0%;
      --pastel-red-1:#ff8aa1; --pastel-blue-1:#78aaff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      overflow-x:hidden;
      overflow-y:hidden; /* 초기엔 스크롤 잠금 → 애니 후 auto */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ===== 화면 좌/우 1:1 분할 ===== */
    .wrap{
      min-height:100vh;
      display:grid;
      grid-template-columns: 1fr 1fr; /* 왼쪽: 텍스트, 오른쪽: 퍼센트 */
    }

    /* ===== 왼쪽: Mars / Keys + Welcome 오버레이 ===== */
    .hero-left{
      position:relative; overflow:visible;
    }
    .brand-box{ padding:5vw; }
    .brand{
      margin:0; line-height:.9;
      font-family:"Michroma", system-ui, sans-serif; /* Michroma 적용 */
      letter-spacing:0.5px;
    }
    .brand-line{
      position:relative; display:block; 
      font-size:clamp(56px,14vw,200px);
    }
    .plain{position:relative; z-index:1;}
    .fill{position:absolute; inset:0; width:var(--fill); overflow:hidden; z-index:2;}
    .fill > span{display:block; color:transparent; -webkit-background-clip:text; background-clip:text;}
    .brand-line[data-c="red"]  .fill > span{background-image:linear-gradient(180deg,var(--pastel-red-1),#ff6b7a,#ff9db0);}
    .brand-line[data-c="blue"] .fill > span{background-image:linear-gradient(180deg,var(--pastel-blue-1),#5ea1ff,#b2d1ff);}
    .tagline{ font-size:clamp(16px,2.6vw,28px); font-weight:600; margin-top:1rem; color:var(--muted); }

    .particles{position:absolute; inset:0; pointer-events:none; overflow:visible;}
    .particle{position:absolute; width:2px; height:2px; border-radius:50%;}
    .brand-line.dissolve .plain,.brand-line.dissolve .fill{opacity:0;}

    /* Welcome: 왼쪽 절반 전체를 덮는 절대 레이어 (잘림 방지) */
    .welcome-wrap{
      position:absolute; inset:0; pointer-events:none; overflow:visible;
    }
    #welcome{
      position:absolute;
      top:50%; left:50%;
      transform:translate(-50%,-50%) scale(0.8);
      opacity:0;
      font-size:clamp(60px,12vw,180px);
      font-family:"Michroma", system-ui, sans-serif;
      color:white;
      letter-spacing:0.02em;
      transition:opacity 1s ease, transform 1s cubic-bezier(.2,.7,.2,1);
      will-change:opacity, transform;
    }
    #welcome.visible{
      opacity:1;
      transform:translate(-50%,-50%) scale(1.45);
    }

    /* ===== 오른쪽: 퍼센트 카운트 (가운데 정렬 보장) ===== */
    .hero-right{
      display:grid; place-items:center; padding:5vw;
    }
    #counter{
      position:relative;  /* 이전 fixed 규칙 무력화 */
      width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      text-align:center;
      font-size:clamp(40px,12vw,160px);
      font-family:"Michroma", system-ui, sans-serif;
      font-weight:900;
      color:white;
      text-shadow:0 0 10px rgba(255,255,255,0.5);
      user-select:none;
      pointer-events:none;
      transition:opacity .6s ease;
    }

    /* ===== 이후 스크롤 콘텐츠 ===== */
    .scrollable-content{
      padding:0 5vw 6rem; 
      text-align:center; 
      display:none; /* 터진 뒤 노출 */
      max-width:1200px; margin:0 auto;
    }
    .scrollable-content p{
      max-width:800px; margin:0 auto 1.5rem; line-height:1.8; 
      color:var(--muted); font-size:clamp(14px,2vw,18px);
    }
    .scrollable-content .temp-box{
      background:rgba(255,255,255,0.05); border-radius:12px; padding:2rem; margin:2rem auto; max-width:900px;
    }

    /* 모바일: 세로 스택 */
    @media (max-width: 768px){
      .wrap{ grid-template-columns: 1fr; }
      .hero-right{ height:50vh; padding:0 6vw 10vw; }
      #counter{ font-size:clamp(40px,18vw,160px); }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <!-- 왼쪽 -->
    <section class="hero-left">
      <canvas id="textCanvas" style="display:none;"></canvas>

      <div class="brand-box">
        <h1 class="brand">
          <span class="brand-line" data-c="red">
            <span class="plain">Mars</span>
            <span class="fill"><span>Mars</span></span>
            <div class="particles"></div>
          </span>
          <span class="brand-line" data-c="blue">
            <span class="plain">Keys</span>
            <span class="fill"><span>Keys</span></span>
            <div class="particles"></div>
          </span>
        </h1>
        <p class="tagline">Video Game Music Studio</p>
      </div>

      <!-- Welcome 오버레이 (왼쪽 절반 전체 덮음) -->
      <div class="welcome-wrap" aria-hidden="true">
        <div id="welcome">Welcome</div>
      </div>
    </section>

    <!-- 오른쪽 -->
    <section class="hero-right">
      <div id="counter" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">0%</div>
    </section>
  </main>

  <div id="scrollContent" class="scrollable-content">
    <p>게임 음악 스튜디오 Mars Keys에 오신 것을 환영합니다...</p>
    <div class="temp-box"><h3>우리의 서비스</h3><p>게임 OST, SFX, VO, 인터랙티브 음악 시스템...</p></div>
    <div class="temp-box"><h3>포트폴리오</h3><p>RPG, SF 어드벤처 등...</p></div>
    <div class="temp-box"><h3>문의</h3><p>협업 및 프로젝트 문의는 언제든지 환영합니다.</p></div>
    <div style="height:60vh;"></div>
    <div class="temp-box"><p>마지막 임시 콘텐츠</p></div>
  </div>

  <script>
  (function(){
    const html=document.documentElement;
    const body=document.body;
    const counterEl=document.getElementById("counter");
    const welcome=document.getElementById("welcome");
    const scrollContent=document.getElementById("scrollContent");

    // 진행도 (0~1). 이 값 하나로 '채움폭'과 '퍼센트' 동기화.
    let p=0;
    const accel=0.0018;
    let particles=[], particlesGenerated=false;
    let autoAnimating=false, isFinalized=false;

    function setProgress(v){
      p=Math.max(0,Math.min(1,v));
      const pct = Math.round(p*100);              // 시각 인지 맞추려고 반올림
      html.style.setProperty('--fill', pct+'%');  // 글자 채움 = 퍼센트 정확 매칭
      if(!isFinalized){
        counterEl.textContent = pct + "%";
        counterEl.setAttribute('aria-valuenow', String(pct));
      }
      if(p>=1 && !particlesGenerated && !isFinalized){
        generateParticles(); 
        dissolveText(); 
        showWelcome();
      }
    }

    function startAutoAnimation(){
      if(autoAnimating||isFinalized) return;
      autoAnimating=true;
      function step(){
        if(p<1){ p = Math.min(1, p+0.005); setProgress(p); requestAnimationFrame(step); }
        else { autoAnimating=false; }
      }
      step();
    }

    function generateParticles(){
      particlesGenerated=true; particles=[];
      const canvas=document.getElementById('textCanvas');
      const ctx=canvas.getContext('2d',{willReadFrequently:true});
      document.querySelectorAll('.brand-line').forEach(line=>{
        const text=line.querySelector('.plain').textContent;
        const style=getComputedStyle(line.querySelector('.plain'));
        const fontSize=parseInt(style.fontSize); 
        const fontFamily=style.fontFamily;
        const w=line.offsetWidth,h=line.offsetHeight;
        canvas.width=w; canvas.height=h;
        ctx.clearRect(0,0,w,h);
        // Michroma는 단일 웨이트 → weight 지정 없이 정확히 사용
        ctx.font=`${fontSize}px ${fontFamily}`;
        ctx.fillStyle='white'; ctx.textBaseline='middle';
        ctx.fillText(text,0,h/2);
        const img=ctx.getImageData(0,0,w,h).data;
        const density=4;
        for(let y=0;y<h;y+=density){
          for(let x=0;x<w;x+=density){
            const idx=(y*w+x)*4;
            if(img[idx+3]>128){
              particles.push({
                x, y,
                vx:(Math.random()-0.5)*2,
                vy:(Math.random()-0.5)*2,
                alpha:1,
                color:line.dataset.c,
                container:line.querySelector('.particles')
              });
            }
          }
        }
      });
    }

    function dissolveText(){
      document.querySelectorAll('.brand-line').forEach(l=>l.classList.add('dissolve'));
      function animate(){
        document.querySelectorAll('.particles').forEach(pc=>pc.innerHTML='');
        particles.forEach(pt=>{
          if(pt.alpha>0){
            const el=document.createElement('div');
            el.className='particle';
            el.style.left=pt.x+'px'; 
            el.style.top=pt.y+'px';
            el.style.opacity=pt.alpha;
            el.style.backgroundColor=`var(--pastel-${pt.color}-1)`;
            pt.container.appendChild(el);
            pt.x+=pt.vx; 
            pt.y+=pt.vy; 
            pt.vx*=1.02; 
            pt.vy*=1.02; 
            pt.alpha-=0.004;
          }
        });
        if(particles.some(pt=>pt.alpha>0)) requestAnimationFrame(animate);
      }
      animate();
    }

    function showWelcome(){
      // 카운터 서서히 숨김 → 왼쪽에서 Welcome 등장
      setTimeout(()=>{ counterEl.style.opacity=0; }, 400);
      setTimeout(()=>{ welcome.classList.add("visible"); }, 1000);
      setTimeout(()=>{
        scrollContent.style.display="block";
        isFinalized=true; 
        body.style.overflowY="auto"; // 스크롤 활성화
      }, 1600);
    }

    function onWheel(e){
      if(isFinalized) return;
      const dy=e.deltaY;
      if(p<0.5){
        e.preventDefault(); 
        setProgress(p+dy*accel); 
        if(p>=0.5) startAutoAnimation();
      }else{
        e.preventDefault(); 
        if(!autoAnimating) startAutoAnimation();
      }
    }

    function onTouchMove(e){
      if(isFinalized) return;
      const touch=e.touches[0]; 
      const currentY=touch.clientY;
      if(typeof onTouchMove.lastY!=="undefined"){
        const dy=onTouchMove.lastY-currentY;
        if(dy>0&&p<0.5){
          e.preventDefault(); 
          setProgress(p+dy*accel*2); 
          if(p>=0.5) startAutoAnimation();
        } else if(dy>0&&p>=0.5&&!autoAnimating){
          e.preventDefault(); 
          startAutoAnimation();
        }
      }
      onTouchMove.lastY=currentY;
    }
    function onTouchEnd(){ if(!isFinalized){ onTouchMove.lastY=undefined; } }

    window.addEventListener('wheel',onWheel,{passive:false});
    window.addEventListener('touchstart',(e)=>{onTouchMove.lastY=e.touches[0].clientY;});
    window.addEventListener('touchmove',onTouchMove,{passive:false});
    window.addEventListener('touchend',onTouchEnd);

    setProgress(0);
  })();
  </script>
</body>
</html>
