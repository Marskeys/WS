<!DOCTYPE html>
<html lang="ko">
<head>
  <title><%= post.title %> | BlindLove</title>
  <link rel="stylesheet" href="/assets/css/signup.css" />
  <link rel="stylesheet" href="/assets/css/post-view.css" />
  <%- include('partials/head') %>
  <style>
    /* ğŸ“‘ ëª©ì°¨ ë°•ìŠ¤ ë””ìì¸ */
    .toc-list {
      font-size: 0; /* ì¤„ë°”ê¿ˆ ê³µë°± ì œê±° */
    }

    .toc-list a {
      font-size: 14px;
      display: block; /* í•œ ì¤„ ì „ì²´ í´ë¦­ ê°€ëŠ¥ */
      line-height: 1.4;
      padding: 2px 6px;
      border-radius: 4px;
      color: #0366d6;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .toc-list a:hover {
      color: #999ff9 !important;
      text-decoration: underline !important;
    }

    html.dark .toc-list a {
      color: #6fb7ff !important;
    }

    html.dark .toc-list a:hover {
      color: #a2d4ff !important;
    }

    .toc-item.toc-h2 {
      padding-left: 1.2rem; /* âœ… ë¶€ì œëª© ë“¤ì—¬ì“°ê¸°*/
    }
    .post-content ul, .post-content ol {
      padding-left: 1em;
      margin: 0.3rem 0;
    }

    .post-content li {
      margin: 0;
      padding: 0;
    }

    .post-content footer {
      display: block;
      font-size: 0.85rem;
      color: #666;
      margin: 0.3em 0;
      line-height: 1.5;
    }

    html.dark .post-content footer {
      color: #aaa;
    }

    .post-content .auto-toc {
      background: #f7f9fa;
      border: 1px solid #d0d7de;
      padding: 1rem 1rem;
      margin-bottom: 1rem;
      border-radius: 6px;
      font-size: 0.95rem;
      line-height: 1.4;
      max-width: 280px;
      width: 100%;
      margin-left: 0;
      margin-right: auto;
    }
    /* ëª¨ë“  h1ì— ê¸°ë³¸ ìœ„ ì—¬ë°±ì„ ì¤Œ */
    .post-content .auto-toc li.toc-h1 {
      margin-top: 0.8rem;
    }
    .post-content .auto-toc .toc-title {
      font-weight: bold;
      margin-bottom: 0rem;
      display: block;
    }

    .post-content .auto-toc ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .post-content .auto-toc li {
      margin: 0.1em 0;
      line-height: 1.2;
      padding-right: 0;
    }

    html.dark .post-content .auto-toc {
      background: #1f1f2b;
      border: 1px solid #444;
      color: #ddd;
    }

    /* ì œëª© ê°„ê²© ì¡°ì • */
    .post-content h1,
    .post-content h2 {
      margin-top: 0.8em;
      margin-bottom: 0.4em;
      line-height: 1.3;
    }

   .post-content .auto-toc + h1,
    .post-content .auto-toc + h2 {
      margin-top: 0.5rem !important;
    } 

    .post-title {
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 1rem;
    }

    .post-meta {
      text-align: center;
      font-size: 0.9rem;
      color: #777;
      margin-bottom: 2rem;
    } 

    /* ì´ê²Œ ë¬¸ì œ */ 
    .post-content {
      line-height: 1.7;
      font-size: 1rem;
      white-space: pre-wrap; 
      color: #333;
      max-width: 640px;
      margin: 0 auto;
      padding-left: 0.5rem;
      position: relative; 
    } 

    html.dark body .post-content {
      color: #ddd;
    }

    .post-actions a.edit-btn,
    .post-actions form button {
      display: inline-block;
      padding: 4px 10px;
      margin: 0 4px;
      border: none;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .post-actions a.edit-btn {
      background-color: #f0f8ff;
      color: #0077cc;
      text-decoration: none;
    }

    .post-actions a.edit-btn:hover {
      background-color: #d8edff;
      color: #005fa3;
    }

    .post-actions form button {
      background-color: #fff0f0;
      color: #cc0000;
      border: 1px solid #cc0000;
    }

    .post-actions form button:hover {
      background-color: #ffe5e5;
      color: #a30000;
    }

    .logo-wrap {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .logo-wrap img {
      max-width: 150px;
      height: auto;
      display: block;
      margin-bottom: 1rem;
    }

    /* ë¸”ëŸ­ ìš”ì†Œë“¤ ì‚¬ì´ ê°„ê²© ì¡°ì ˆ*/
    .post-content p
 {
  margin-bottom: 3rem;
}

.post-content h1
 {
  margin-top: 2rem;
}

.post-content h2
 {
  margin-bottom: 2rem;
  margin-top: 2rem;
}


  </style>
</head>
<body class="no-fixed-footer">
  <%- include('partials/header') %>

  <div class="signup-container">
    <div class="logo-wrap">
      <img src="/assets/images/post-view.png" alt="BlindLove ë¡œê³ " />
    </div>

    <div class="post-title"><%= post.title %></div>

    <div class="post-meta">
      <span>ì¹´í…Œê³ ë¦¬: <%= post.categories %></span><br>
      <span>ì‘ì„±ì: <%= post.author %></span><br>
      <span>ì‘ì„±ì¼: <%= new Date(post.created_at).toLocaleString() %></span>
    </div>

    <!-- ğŸ“¢ ê´‘ê³  ì‚½ì… -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2585969189290118"
     crossorigin="anonymous"></script>
    <ins class="adsbygoogle"
         style="display:block; text-align:center;"
         data-ad-layout="in-article"
         data-ad-format="fluid"
         data-ad-client="ca-pub-2585969189290118"
         data-ad-slot="3406391330"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

    <!-- ğŸ“œ ê²Œì‹œê¸€ ë‚´ìš© -->
    <div class="post-content">
      <%- post.content %>
    </div>

    <!-- âœï¸ ìˆ˜ì • / ì‚­ì œ ë²„íŠ¼ -->
    <% if (user && post.user_id == user.id) { %>
      <div class="post-actions" style="text-align: center; margin-top: 1.5rem;">
        <a href="/edit/<%= post.id %>" class="edit-btn">âœï¸ ìˆ˜ì •í•˜ê¸°</a>
        <form action="/delete/<%= post.id %>" method="POST" style="display: inline;">
          <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ì–´ìš”?');">ğŸ—‘ ì‚­ì œí•˜ê¸°</button>
        </form>
      </div>
    <% } %>

    <div class="extra" style="margin-top: 2rem; text-align: center;">
      <a href="/" class="back-home-link">â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
  </div>

  <script>
    // ----------------------------------------------------
    // ëª¨ë“  DOM ë¡œë”©ì´ ì™„ë£Œëœ í›„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
    // ----------------------------------------------------
    document.addEventListener("DOMContentLoaded", () => {
  
      // 1. ë‚´ê°€ ë§Œë“  HTML ìœ„ì ¯(iframe) ì²˜ë¦¬ ë¡œì§
      document.querySelectorAll('.custom-widget[data-type="html-snippet"]').forEach((el, index) => {
        const encoded = el.getAttribute("data-code");
        if (!encoded) return;
  
        try {
          const binaryString = atob(encoded);
          const len = binaryString.length;
          const bytes = new Uint8Array(len);
          for (let i = 0; i < len; i++) {
            bytes[i] = binaryString.charCodeAt(i);
          }
          const decoder = new TextDecoder('utf-8');
          const decoded = decoder.decode(bytes);
  
          const iframe = document.createElement('iframe');
          iframe.setAttribute('sandbox', 'allow-scripts');
          iframe.setAttribute('referrerpolicy', 'no-referrer');
          iframe.setAttribute('title', 'ì‚½ì…ëœ HTML');
          iframe.setAttribute('name', `snippet-iframe-${index}`);
  
          iframe.style.width = '100%';
          iframe.style.minHeight = '100px';
          iframe.style.border = '1px solid #ccc';
          iframe.style.borderRadius = '8px';
          iframe.style.margin = '1rem 0';
          iframe.srcdoc = decoded;
  
          el.innerHTML = '';
          el.appendChild(iframe);
        } catch (e) {
          el.innerHTML = '<p style="color:red;">[HTML ì½”ë“œ ë””ì½”ë”© ì‹¤íŒ¨]</p>';
          console.error('ë””ì½”ë”© ì˜¤ë¥˜:', e);
        }
      });
  
      // 2. ë³¸ë¬¸ ë‚´ ê´‘ê³  ë™ì  ì‚½ì… ë¡œì§
      const adCode = `
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-2585969189290118"
             data-ad-slot="7758400001"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      `;
      const postContent = document.querySelector('.post-content');
      if (postContent) {
        const potentialAdTargets = postContent.querySelectorAll('p, h2');
        const adPositions = [2, 6]; // ğŸ‘ˆ ê´‘ê³  ìœ„ì¹˜ëŠ” ì—¬ê¸°ì„œ ì¡°ì ˆ
  
        adPositions.forEach(position => {
          if (potentialAdTargets.length > position) {
            const targetElement = potentialAdTargets[position];
            const adContainer = document.createElement('div');
            adContainer.innerHTML = adCode;
            
            targetElement.insertAdjacentElement('afterend', adContainer);
            
            try {
              (adsbygoogle = window.adsbygoogle || []).push({});
            } catch (e) {
              console.error("Adsense push error: ", e);
            }
          }
        });
      }
  
      // 3. .post-body ì•ˆì˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ë¡œì§ (í•„ìš” ì‹œ ì‚¬ìš©)
      document.querySelectorAll('.post-body script').forEach(script => {
          const newScript = document.createElement('script');
          if (script.src) {
              newScript.src = script.src;
          } else {
              newScript.textContent = script.textContent;
          }
          document.body.appendChild(newScript);
      });
    });
  
    // ----------------------------------------------------
    // iframe ë†’ì´ ì¡°ì ˆ ê´€ë ¨ í•¨ìˆ˜ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    // (DOMContentLoaded ë°”ê¹¥ì— ìˆì–´ë„ ê´œì°®ì€ ë¶€ë¶„)
    // ----------------------------------------------------
    function sendHeightToParent() {
      const body = document.body;
      const html = document.documentElement;
      const height = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight);
      const iframeName = window.name;
  
      if (window.parent) {
        window.parent.postMessage({
          type: 'setIframeHeight',
          height: height,
          iframeName: iframeName
        }, '*');
      }
    }
  
    window.addEventListener('message', (event) => {
      if (event.data && event.data.type === 'setIframeHeight') {
        const iframeName = event.data.iframeName;
        const height = event.data.height;
        const targetIframe = document.querySelector(`iframe[name="${iframeName}"]`);
        if (targetIframe) {
          targetIframe.style.height = `${height}px`;
        }
      }
    });
  
    window.addEventListener('load', sendHeightToParent);
    window.addEventListener('resize', sendHeightToParent);
  </script>
 
<!-- ë– ë‹¤ë‹ˆëŠ” ëª©ì°¨ ì˜ì—­ (ë°ìŠ¤í¬íƒ‘) -->
<div class="floating-toc" id="floatingToc"></div>

<!-- ëª¨ë°”ì¼ ëª©ì°¨ ë²„íŠ¼ -->
<div class="mobile-toc-button" id="mobileTocBtn">ğŸ“‘</div>

<!-- ëª¨ë°”ì¼ ëª©ì°¨ ëª¨ë‹¬ -->
<div class="mobile-toc-modal" id="mobileTocModal">
  <div class="mobile-toc-content" id="mobileTocContent"></div>
</div>


  <%- include('partials/footer') %>
  <%- include('partials/scripts') %>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toc = document.querySelector(".auto-toc");
      const floatingToc = document.getElementById("floatingToc");
      const mobileBtn = document.getElementById("mobileTocBtn");
      const mobileModal = document.getElementById("mobileTocModal");
      const mobileContent = document.getElementById("mobileTocContent");
    
      // ğŸ“± ëª¨ë°”ì¼ ëª©ì°¨ì—ì„œ í•­ëª© í´ë¦­í•˜ë©´ ëª¨ë‹¬ ë‹«ê¸° + ì´ë™
mobileContent.addEventListener("click", (e) => {
  if (e.target.tagName === "A") {
    e.preventDefault();
    const targetId = e.target.getAttribute("href").replace("#", "");
    const el = document.getElementById(targetId);
    if (el) {
      el.scrollIntoView({ behavior: "smooth" });
      mobileModal.style.display = "none"; // âœ… íŒì—… ë‹«ê¸°
    }
  }
});

      if (!toc) return;
    
      // ğŸ’» ë°ìŠ¤í¬íƒ‘ìš© ë– ë‹¤ë‹ˆëŠ” ëª©ì°¨ ìƒì„±
      floatingToc.innerHTML = toc.innerHTML;
    
      // ğŸ“± ëª¨ë°”ì¼ìš© ëª©ì°¨ íŒì—… ìƒì„±
      mobileContent.innerHTML = toc.innerHTML;
    
      // ğŸ“± ëª¨ë‹¬ ì—´ê¸°
      mobileBtn.addEventListener("click", () => {
        mobileModal.style.display = "flex";
      });
    
      // ğŸ“± ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
      mobileModal.addEventListener("click", (e) => {
        if (e.target === mobileModal) {
          mobileModal.style.display = "none";
        }
      });
    
    


      // âœ… ê°ì§€ ê¸°ì¤€ì´ ë˜ëŠ” ìš”ì†Œë¥¼ ëª©ì°¨ ë°”ë¡œ ë’¤ì— ì¶”ê°€
const sentinel = document.createElement("div");
sentinel.id = "toc-bottom-sentinel";
sentinel.style.height = "1px";
toc.after(sentinel);

// ê¸°ì¡´ observer ëŒ€ì‹  ìƒˆ observerë¡œ ëŒ€ì²´
const visibilityObserver = new IntersectionObserver((entries) => {
  const entry = entries[0];
  if (entry.isIntersecting) {
    // ì•„ì§ ëª©ì°¨ ì•„ë˜ ì•ˆ ë‚´ë ¤ê° â†’ ìˆ¨ê¹€
    floatingToc.style.display = "none";
    mobileBtn.style.display = "none";
  } else {
    // ëª©ì°¨ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•¨ â†’ í‘œì‹œ
    floatingToc.style.display = "block";
    mobileBtn.style.display = "flex";
  }
}, {
  rootMargin: '0px 0px -80% 0px'  // ìŠ¤í¬ë¡¤ ì•½ê°„ ë‚´ë ¤ê°€ì•¼ ê°ì§€ë¨
});

visibilityObserver.observe(document.getElementById("toc-bottom-sentinel"));

    });
    </script>
    
</body>
</html>
