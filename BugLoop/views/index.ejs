<!DOCTYPE html>
<html class="dark" lang="<%= lang %>">
<head>
  <%- include('partials/head') %>
  <link rel="stylesheet" href="/assets/css/index.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bug Loop · Online HTML Editor</title>
  <style>
    :root{
      --chrome-gap:50px; /* 좌측 VSCode 사이드바 여백(모바일도 적용) */
      --panel-gap:16px;
      --radius:12px;
      --border:#2b2b2b;
      --bg:#1b1b1b;
      --panel:#121212;
      --panel-2:#0e0e0e;
      --ink:#eaeaea;
      --ink-2:#b7b7b7;
      --accent:#00f5d4;     /* 포인트 */
      --primary:#20c67e;    /* 밝은 초록 (Run, Assets-URL 버튼) */
      --primary-ink:#ffffff;
    }
    html:not(.dark){
      --border:#d9d9d9;
      --bg:#f6f6f8;
      --panel:#ffffff;
      --panel-2:#f3f3f6;
      --ink:#1f1f1f;
      --ink-2:#5a5a5a;
      --accent:#3c6df0;
      --primary:#27c477;
      --primary-ink:#ffffff;
    }

    body.light, body.dark { background: var(--bg); color: var(--ink); }

    /* 앱 쉘: 모바일도 좌측 50px 여백 */
    .app-shell{
      padding: 16px 16px 16px calc(var(--chrome-gap) + 16px);
      padding-top: calc(50px + 16px); /* 상단에도 50px 메뉴 여백 */
      margin-top: 150px;
    }

    @media (max-width: 640px){
  .app-shell{
    padding-left: 16px;
    margin-top: 250px;
  }
}

    /* 상단 바 */
    .studio-bar{
      display:flex; align-items:center; gap:10px;
      background:var(--panel); border:1px solid var(--border);
      border-radius: var(--radius); padding:10px 12px; margin-bottom:12px;
    }
    .studio-title{ font-weight:700; letter-spacing:.3px }
    .studio-spacer{ flex:1 }
    .btn{
      border:1px solid var(--border); background:var(--panel-2);
      border-radius:10px; padding:8px 12px; font-weight:600; cursor:pointer; color:var(--ink);
    }
    .btn:hover{ filter: brightness(1.05) }
    .btn.primary{
      background: var(--primary);
      color: var(--primary-ink);
      border-color: transparent;
    }

    /* 레이아웃 */
    .workbench{
      display:grid; gap: var(--panel-gap);
      grid-template-columns: 1fr;
    }
    @media (min-width:1024px){
      .workbench{
        grid-template-columns: 320px minmax(0,1fr) minmax(0,1fr);
        align-items: stretch;
      }
    }

    /* 좌측 선택창 (데스크탑 전용) */
    .selector{
      display:none;
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0)) , var(--panel);
      border:1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: var(--shadow, 0 10px 30px rgba(0,0,0,.35));
    }
    @media (min-width:1024px){ .selector{ display:block } }

    .selector-header{
      position: sticky; top: 0;
      backdrop-filter: blur(6px);
      background: linear-gradient(180deg, rgba(0,0,0,.06), rgba(0,0,0,0));
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      display:flex; align-items:center; gap:10px;
      font-weight: 700; letter-spacing: .2px;
    }
    .selector-actions{ margin-left:auto; display:flex; gap:8px; }
    .icon-btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--border);
      border-radius:10px; background:var(--panel-2); cursor:pointer; color:var(--ink);
      font-weight:600;
    }
    .icon-btn svg{ width:16px; height:16px; }
    .icon-btn:hover{ filter:brightness(1.05) }

    .selector-list{ display:flex; flex-direction:column; padding: 6px; gap: 6px; max-height: calc(100vh - 220px); overflow: auto; }

    .selector-item{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border:1px solid transparent;
      border-radius:10px; background:var(--panel-2); color:var(--ink-2);
      transition: border-color .15s, background .15s, color .15s, transform .05s;
    }
    .selector-item:hover{ border-color:var(--border); color:var(--ink) }
    .selector-item:active{ transform: translateY(1px); }
    .selector-item.active{
      color:var(--ink);
      background: linear-gradient(180deg, rgba(124,158,255,.08), transparent), var(--panel-2);
      border-color: var(--accent);
      position: relative;
    }
    .selector-item.active::before{
      content:""; position:absolute; left:-6px; top:8px; bottom:8px; width:3px; border-radius:3px; background:var(--accent);
    }
    .selector-item .tag{
      margin-left:auto; font-size:.72rem; border:1px solid var(--border); background:rgba(127,127,127,.08);
      padding:2px 8px; border-radius:999px; color:var(--ink-2);
    }

    /* 모바일 탭(모바일 전용) */
    .mobile-tabs{ display:flex; gap:6px; margin-bottom:10px }
    .mobile-tab{ flex:1; border:1px solid var(--border); background:var(--panel); padding:10px; border-radius:10px; font-weight:600 }
    .mobile-tab.active{ outline:2px solid var(--accent) }
    @media (min-width:1024px){ .mobile-tabs{ display:none } }

    /* 에디터 카드 */
    .editor-card{
      background:var(--panel); border:1px solid var(--border); border-radius: var(--radius);
      padding:12px; display:flex; flex-direction:column; gap:8px; min-height: 0;
    }
    .code-preview-title{ font-weight:700; margin:4px 0 6px }
    .code-area{ flex:1; min-height:240px; }

    textarea.code{
      width:100%; height:100%;
      border:1px solid var(--border); background:var(--panel-2);
      border-radius:10px; padding:12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "D2Coding", monospace;
      font-size:14px; color:var(--ink); outline:none; resize:vertical;
      min-height: 360px; /* 모바일도 넉넉하게 */
    }
    @media (min-width:1024px){
      textarea.code{ min-height: 620px; resize: none; }
    }

    /* 프리뷰 카드 */
    .preview-card{
      background:var(--panel); border:1px solid var(--border); border-radius: var(--radius);
      overflow:hidden; display:flex; flex-direction:column;
    }
    .preview-bar{ display:flex; align-items:center; gap:8px; padding:10px 12px; border-bottom:1px solid var(--border) }
    .preview-addr{ flex:1; border:1px solid var(--border); background:var(--panel-2); padding:6px 10px; border-radius:8px; font-size:12px; color:var(--ink-2) }
    #code-preview-frame{ width:100%; height:420px; border:0; background:var(--panel-2) }

    /* 🔴 깜빡이는 빨간 점 */
.rec-dot{
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background-color: #ff4747;
  box-shadow: 0 0 6px rgba(255,71,71,0.8);
  animation: blink-rec 1s infinite;
}
@keyframes blink-rec {
  0%, 100% {
    opacity: 1;
    box-shadow: 0 0 6px rgba(255,71,71,0.8);
  }
  50% {
    opacity: 0.4;
    box-shadow: 0 0 2px rgba(255,71,71,0.4);
  }
}


    /* 상태바 */
    .statusbar{
      margin-top:12px; background:var(--panel); border:1px solid var(--border);
      border-radius: var(--radius); padding:8px 12px; display:flex; gap:12px; color:var(--ink-2); font-size:.9rem;
    }

    /* 모달(Assets) */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index: 9999; }
    .modal{ width:min(680px, 92vw); background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:16px; }
    .modal h3{ margin:0 0 8px 0 }
    .modal form{ display:grid; grid-template-columns: 1fr 110px 120px; gap:8px; align-items:center }
    .asset-list{ margin-top:10px; border-top:1px dashed var(--border); padding-top:10px; max-height: 40vh; overflow:auto }
    .asset-pill{ display:flex; gap:10px; align-items:center; border:1px solid var(--border); background:var(--panel-2); padding:8px 10px; border-radius:10px; margin-bottom:8px }
    .asset-pill code{ font-size:.85rem; color:var(--ink-2) }
    .tag{ font-size:.75rem; border:1px solid var(--border); padding:2px 6px; border-radius:999px }

    .hidden{ display:none !important; }
  </style>
</head>

<body class="light">
  <div id="preloader"><div class="spinner"></div></div>
  <%- include('partials/header') %>

  <div id="panel-root"></div>
  <%- include('partials/panel') %>
</div>

  <div class="app-shell">
    <!-- 상단 앱 바 -->
    <div class="studio-bar">
      <div class="studio-title">Bug Loop · Online HTML Editor</div>
      <span class="studio-badge"></span>
      <div class="studio-spacer"></div>
      <button id="btn-run" class="btn primary">Run ⏎</button>
      <button id="btn-assets" class="btn">Assets</button>
    </div>

    <!-- 모바일 상단 탭 (모바일 전용) -->
    <div class="mobile-tabs" id="mobileTabs">
      <button class="mobile-tab active" data-tab="html">HTML</button>
      <button class="mobile-tab" data-tab="css">CSS</button>
      <button class="mobile-tab" data-tab="js">JS</button>
    </div>

    <!-- 작업영역 -->
    <div class="workbench">
      <!-- 좌측 선택창 (데스크탑 전용) -->
      <aside class="selector" id="desktopSelector">
        <div class="selector-header">
          Files
          <div class="selector-actions">
            <!-- 디스크 아이콘(저장/다운로드) -->
            <button id="btn-download-all" class="icon-btn" title="Download files">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                <path d="M12 3v12m0 0l-4-4m4 4l4-4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20 21H4a2 2 0 0 1-2-2v-4" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Save
            </button>
          </div>
        </div>
        <div class="selector-list" role="tablist" aria-label="Editor files">
          <button class="selector-item active" data-tab="html"><strong>index.html</strong><span class="tag">HTML</span></button>
          <button class="selector-item" data-tab="css"><strong>styles.css</strong><span class="tag">CSS</span></button>
          <button class="selector-item" data-tab="js"><strong>app.js</strong><span class="tag">JS</span></button>
        </div>
      </aside>

      <!-- 가운데: 에디터 -->
      <section class="editor-card">
        <h1 class="code-preview-title"><%= locale.editor["editor-title"] %></h1>

        <div class="code-area">
          <!-- 에디터 3종 -->
          <div id="code-editor-html" class="editor-pane">
            <textarea id="code-preview-html-code" class="code">
<header>
  <%= locale.editor["example-html"] %>
</header>
            </textarea>
          </div>

          <div id="code-editor-css" class="editor-pane hidden">
            <textarea id="code-preview-css-code" class="code">body {
  background: #fff;
  color: #222;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  text-align: center;
  margin: 0;
  padding: 0;
}
header {
  background-color: #f0f4ff;
  padding: 20px 0;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}
header h1 { margin: 0; color: #3366cc; }
nav ul {
  list-style: none; padding: 0; margin: 10px 0 0;
  display: flex; justify-content: center; gap: 20px;
}
nav li { font-weight: bold; color: #444; }
main { padding: 40px 20px; }
section { margin-bottom: 40px; }
h2 { color: #444; margin-bottom: 10px; }
ul { list-style: none; padding: 0; }
ul li { margin: 5px 0; font-size: 1.1rem; }
footer {
  background: #f9f9f9; padding: 20px 0; font-size: .9rem;
  color: #888; border-top: 1px solid #eee;
}
            </textarea>
          </div>

          <div id="code-editor-js" class="editor-pane hidden">
            <textarea id="code-preview-js-code" class="code">document.body.style.transform = 'scale(1.02)';</textarea>
          </div>
        </div>
      </section>

      <!-- 우측: 프리뷰 -->
      <section class="preview-card">
      <!-- 프리뷰 헤더 -->
<div class="preview-bar">
  <span class="rec-dot" title="Live"></span>
  <span class="studio-badge">Live Preview</span>
  <div class="preview-addr">bugloop://preview</div>
</div>
        <iframe id="code-preview-frame" sandbox="allow-scripts allow-forms"></iframe>
      </section>
    </div>

    <!-- 상태바 -->
    <div class="statusbar">
      <span id="status-msg">Ready — Press Run to update preview</span>
      <span>⌘/Ctrl+Enter: Run</span>
      <span>⌘/Ctrl+B: Toggle Sidebar</span>
    </div>
  </div>

  <!-- Assets 모달 -->
  <div class="modal-backdrop" id="assetsModal">
    <div class="modal">
      <h3>Assets</h3>
      <p class="studio-badge">CSS/JS를 추가하면 프리뷰 head에 자동 주입됩니다.</p>
      <form id="assetForm">
        <input id="assetUrl" type="url" placeholder="https://cdn.example.com/library.min.js 또는 .css" />
        <select id="assetType">
          <option value="js">JS</option>
          <option value="css">CSS</option>
        </select>
        <!-- Add URL 버튼도 밝은 초록 -->
        <button type="submit" class="btn primary">Add URL</button>
      </form>
      <div style="margin-top:8px; display:flex; gap:8px; align-items:center">
        <input type="file" id="assetFile" />
        <select id="assetFileType">
          <option value="js">JS</option>
          <option value="css">CSS</option>
        </select>
        <button id="assetAddFile" class="btn">Add File</button>
        <div class="studio-spacer"></div>
        <button id="assetClose" class="btn">Close</button>
      </div>
      <div class="asset-list" id="assetList"></div>
    </div>
  </div>

  <%- include('partials/scripts') %>
  <script>
    // ====== 요소 참조
    const htmlInput = document.getElementById('code-preview-html-code');
    const cssInput  = document.getElementById('code-preview-css-code');
    const jsInput   = document.getElementById('code-preview-js-code');
    const preview   = document.getElementById('code-preview-frame');

    const desktopSelector = document.getElementById('desktopSelector');
    const selectorItems = desktopSelector.querySelectorAll('.selector-item');

    const mobileTabs = document.getElementById('mobileTabs');
    const mobileTabButtons = mobileTabs.querySelectorAll('.mobile-tab');

    const btnRun = document.getElementById('btn-run');

    const btnAssets = document.getElementById('btn-assets');
    const assetsModal = document.getElementById('assetsModal');
    const assetForm = document.getElementById('assetForm');
    const assetUrlEl = document.getElementById('assetUrl');
    const assetTypeEl = document.getElementById('assetType');
    const assetFileEl = document.getElementById('assetFile');
    const assetFileTypeEl = document.getElementById('assetFileType');
    const assetAddFileBtn = document.getElementById('assetAddFile');
    const assetListEl = document.getElementById('assetList');
    const assetClose = document.getElementById('assetClose');

    const btnDownloadAll = document.getElementById('btn-download-all');

    const statusMsg = document.getElementById('status-msg');

    // ====== 상태
    let currentTab = 'html'; // html | css | js
    const assets = []; // {id, type:'js'|'css', src, label, isBlob}

    // ====== 탭 전환 (데스크탑 선택창)
    selectorItems.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        selectorItems.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        setTab(btn.dataset.tab);
      });
    });

    // ====== 모바일 탭
    mobileTabButtons.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        mobileTabButtons.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        setTab(btn.dataset.tab);
      });
    });

    function setTab(tab){
      currentTab = tab;
      document.getElementById('code-editor-html').classList.toggle('hidden', tab!=='html');
      document.getElementById('code-editor-css').classList.toggle('hidden',  tab!=='css');
      document.getElementById('code-editor-js').classList.toggle('hidden',   tab!=='js');
      status('Editing ' + tab.toUpperCase());
    }

    // ====== 프리뷰 빌드 (Run 눌러야 반영)
    function buildSrcDoc(){
      const html = htmlInput.value;
      const cssContent = cssInput.value + `
@media screen and (max-width: 768px) {
  body { font-size: 80% !important; }
  h1, h2, h3, h4, h5, h6, p, li, nav, footer, main, section {
    transform: scale(0.95); transform-origin: top center;
  }
}
`;
      const cssTag = `<style>${cssContent.replace(/<\/style>/g,'<\\/style>')}</style>`;
      const jsTag  = `<script>${jsInput.value.replace(/<\/script>/g,'<\\/script>')}<\/script>`;

      const assetTags = assets.map(a=>{
        if(a.type==='css'){
          return `<link rel="stylesheet" href="${a.src}">`;
        }else{
          return `<script src="${a.src}"><\/script>`;
        }
      }).join('\n');

      return `<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
${assetTags}
${cssTag}
</head>
<body>
${html}
${jsTag}
</body>
</html>`;
    }

    function updatePreview(){
      preview.srcdoc = buildSrcDoc();
      status('Preview updated');
    }

    // 자동 미리보기 제거 → Run/단축키로만 갱신
    btnRun.addEventListener('click', updatePreview);
    window.addEventListener('keydown', (e)=>{
      const cmd = e.metaKey || e.ctrlKey;
      if(cmd && e.key.toLowerCase()==='enter'){ e.preventDefault(); updatePreview(); }
      if(cmd && e.key.toLowerCase()==='b'){ e.preventDefault(); document.querySelector('.selector')?.classList.toggle('hidden'); }
    });

    // ====== Assets: 모달 열기/닫기
    btnAssets.addEventListener('click', ()=> assetsModal.style.display='flex');
    assetClose.addEventListener('click', ()=> assetsModal.style.display='none');
    assetsModal.addEventListener('click', (e)=>{ if(e.target===assetsModal) assetsModal.style.display='none'; });

    // ====== Assets: URL 추가 (Run과 같은 밝은 초록 스타일은 CSS로 적용됨)
    assetForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const url = assetUrlEl.value.trim();
      const type = assetTypeEl.value;
      if(!url) return;
      addAsset({type, src:url, label:url, isBlob:false});
      assetUrlEl.value='';
      // Assets 추가만으로는 미리보기에 즉시 반영 안 함: Run 눌러서 갱신 철학 유지
    });

    // ====== Assets: 파일 추가 (Blob URL)
    assetAddFileBtn.addEventListener('click', ()=>{
      const f = assetFileEl.files?.[0];
      if(!f) return;
      const type = assetFileTypeEl.value;
      const url = URL.createObjectURL(f);
      addAsset({type, src:url, label:f.name, isBlob:true});
      assetFileEl.value='';
    });

    function addAsset(a){
      const id = 'asset_'+Math.random().toString(36).slice(2,9);
      assets.push({...a, id});
      renderAssetList();
      status(`Asset added: ${a.label} (press Run to apply)`);
    }

    function removeAsset(id){
      const idx = assets.findIndex(x=>x.id===id);
      if(idx>=0){
        const a = assets[idx];
        if(a.isBlob) try{ URL.revokeObjectURL(a.src); }catch{}
        assets.splice(idx,1);
        renderAssetList();
        status('Asset removed (press Run to apply)');
      }
    }

    function renderAssetList(){
      assetListEl.innerHTML = '';
      assets.forEach(a=>{
        const row = document.createElement('div');
        row.className='asset-pill';
        row.innerHTML = `
          <span class="tag">${a.type.toUpperCase()}</span>
          <code title="${a.label}">${a.label}</code>
          <div style="flex:1"></div>
          <button class="btn" data-id="${a.id}">Remove</button>
        `;
        row.querySelector('button').addEventListener('click', ()=> removeAsset(a.id));
        assetListEl.appendChild(row);
      });
      if(!assets.length){
        const empty = document.createElement('div');
        empty.className='studio-badge';
        empty.textContent = 'No assets added yet.';
        assetListEl.appendChild(empty);
      }
    }

    // ====== Download files (디스크 버튼)
    btnDownloadAll.addEventListener('click', ()=>{
      downloadFile('index.html', htmlInput.value.trim());
      downloadFile('styles.css', cssInput.value.trim());
      downloadFile('app.js', jsInput.value.trim());
      status('Files downloaded');
    });

    function downloadFile(filename, content){
      const blob = new Blob([content], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 500);
    }

    function status(msg){ statusMsg.textContent = msg; }

    // 초기 탭 상태
    window.addEventListener('DOMContentLoaded', ()=> setTab('html'));
  </script>

<script>
  (() => {
    const panelRoot = document.getElementById('panel-root');
    const preloader = document.getElementById('preloader');
  
    // 메뉴 클릭 가로채기
    document.addEventListener('click', (e) => {
      const a = e.target.closest('a[data-panel-link]');
      if (!a) return;
      if (a.target === '_blank' || e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;
      e.preventDefault();
      loadPanel(a.href, true);
    });
  
    // 뒤로/앞으로
    window.addEventListener('popstate', () => loadPanel(location.href, false));
  
    async function loadPanel(url, push) {
      try {
        setLoading(true);
  
        // 서버가 fragment를 확실히 인지하도록: 헤더 + 쿼리파라미터 둘 다
        const fURL = new URL(url, location.origin);
        fURL.searchParams.set('_fragment', 'panel'); // 서버가 지원하면 이걸로 분기
  
        const res = await fetch(fURL.toString(), {
          headers: {
            'X-Panel-Only': '1',                                 // 커스텀 헤더 트리거
            'Accept': 'text/html, text/fragment;q=1.0, */*;q=0.5'
          },
          credentials: 'same-origin',
          cache: 'no-cache'
        });
  
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const html = await res.text();
  
        // 조각 또는 전체 HTML 모두 처리
        const frag = extractPanel(html);
        if (!frag) {
          // 조각 추출 실패 시 폴백 (전체 내비게이션)
          location.href = url;
          return;
        }
  
        panelRoot.replaceChildren(frag);
        runScripts(panelRoot);
        updateActiveMenu(url);
  
        if (push) history.pushState({ panel: true }, '', url);
      } catch (err) {
        console.error('[PJAX] loadPanel error:', err);
        location.href = url; // 폴백
      } finally {
        setLoading(false);
      }
    }
  
    // 서버가 fragment만 주면 그대로 쓰고,
    // 전체 HTML이면 DOMParser로 #panel-root(or data-panel-fragment)만 뽑아옴
    function extractPanel(html) {
      if (!/<\/?html[\s>]/i.test(html)) {
        const wrap = document.createElement('div');
        wrap.innerHTML = html;
        const df = document.createDocumentFragment();
        while (wrap.firstChild) df.appendChild(wrap.firstChild);
        return df;
      }
      const doc = new DOMParser().parseFromString(html, 'text/html');
      const node = doc.querySelector('#panel-root, [data-panel-fragment], .panel-root');
      if (!node) return null;
      const df = document.createDocumentFragment();
      node.childNodes.forEach(n => df.appendChild(n.cloneNode(true)));
      return df;
    }
  
    // 새로 삽입된 <script> 실행
    function runScripts(root) {
      root.querySelectorAll('script').forEach(old => {
        const s = document.createElement('script');
        [...old.attributes].forEach(attr => s.setAttribute(attr.name, attr.value));
        s.textContent = old.textContent;
        old.replaceWith(s);
      });
    }
  
    // 메뉴 active 상태 업데이트
    function updateActiveMenu(url) {
      const path = new URL(url, location.origin).pathname.replace(/\/$/, '');
      document.querySelectorAll('.submenu a').forEach(a => {
        const href = (a.getAttribute('href') || '').replace(/\/$/, '');
        if (href === path) {
          a.classList.add('active');
          a.closest('.menu-item-wrapper')?.querySelector('.menu-label')?.classList.add('active-label');
        } else {
          a.classList.remove('active');
        }
      });
    }
  
    function setLoading(on) {
      if (!preloader) return;
      preloader.style.display = on ? 'block' : 'none';
    }
  })();
  </script>
  
</body>
</html>
