<div class="full-header-container">
  <div class="header-top">
    <div class="top-controls">
      <div class="left-controls">
        <%
        const pathWithoutLang = currentPath.replace(/^\/(ko|en|fr|zh|ja)/, '');
        const showLogo = ['/signup', '/editor', '/login', '/write'].includes(pathWithoutLang) ||
                        pathWithoutLang.startsWith('/post') ||
                        pathWithoutLang.startsWith('/edit');
        %>
        <% if (showLogo) { %>
          <a href="/<%= lang %>/" class="logo-link">
  
          </a>
        <% } %>
      </div>
      <div class="right-controls"></div>
    </div>
  </div>

  <aside class="side-panel main-panel-only">
    <div class="sidebar-wrapper">
      <nav class="vscode-sidebar">
        <a href="https://www.bugloop.dev" class="sidebar-icon active" data-tab="home" title="í™ˆ"><i class="fas fa-home"></i></a>
          <!-- ğŸ‘‰ íŒ¨ë„ í† ê¸€ ì•„ì´ì½˜ ì¶”ê°€ -->
      <a href="#" class="sidebar-icon toggle-panel" title="íŒ¨ë„ ì ‘ê¸°/í¼ì¹˜ê¸°">
        <i class="fas fa-chevron-left"></i>
      </a>
      
        <a href="#" class="sidebar-icon" data-tab="profile" title="í”„ë¡œí•„"><i class="fas fa-user"></i></a>
        <a href="#" class="sidebar-icon" data-tab="search" title="ê²€ìƒ‰"><i class="fas fa-search"></i></a>
      
        <% if (user) { %>
          <% if (Number(user.is_admin) === 1) { %>
            <a href="/<%= lang %>/write" class="sidebar-icon" data-tab="write" title="ê¸€ì“°ê¸°">
              <i class="fas fa-pen"></i>
            </a>
          <% } %>
          <a href="#" class="sidebar-icon" data-tab="settings" title="ì„¤ì •">
            <i class="fas fa-cog"></i>
          </a>
        <% } %>
      </nav>
      

      <div class="sidebar-extension-panel">
        <div style="flex-grow: 1; overflow-y: auto;">

          <div class="tab-content" data-tab="profile" style="display: none;">
            <h3>í”„ë¡œí•„</h3>
          </div>

          <% if (typeof posts !== 'undefined') { %>
            <div class="tab-content" data-tab="search" style="display: none;">
              <%- include('table') %>
            </div>
          <% } %>

      

          <div class="tab-content" data-tab="settings" style="display: none;">
            <h3>ì„¤ì •</h3>
            <label><input type="checkbox"> ë‹¤í¬ ëª¨ë“œ</label>
          </div>
        </div>

        <div style="border-top: 1px solid #444; padding: 10px;">
          <% if (currentPath !== '/signup' && currentPath !== '/login') { %>
            <div class="auth-buttons" style="display: flex; flex-direction: column; gap: 10px;">
              <% if (user) { %>
                <% if (Number(user.is_admin) === 1) { %>
                  <span class="welcome-text" style="font-size: 0.85rem; color: #aaa; text-align: center;"><strong><%= user.nickname %></strong>ë‹˜ ì•ˆë…•í•˜ì„¸ìš”!</span>
                <% } %>
                <a href="/<%= lang %>/logout" class="auth-btn logout" style="width: 100%; text-align: center;">ë¡œê·¸ì•„ì›ƒ</a>
              <% } else { %>
                <a class="auth-btn signup" onclick="delayNavigation(event, '/<%= lang %>/signup')" style="width: 100%; text-align: center;">íšŒì›ê°€ì…</a>
                <button class="auth-btn login" id="login" type="button" style="width: 100%; text-align: center;">ë¡œê·¸ì¸</button>
              <% } %>
            </div>
          <% } %>

          <!-- ë¡œê·¸ì¸ í¼ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
<div id="login-form-container" style="display: none; padding: 10px; border-top: 1px solid #444; background-color: #222;">
  <form id="login-form" method="POST" action="/login" style="display: flex; flex-direction: column; gap: 8px;">
    <input type="text" name="id" placeholder="ì•„ì´ë””" required style="padding: 5px;" />
    <input type="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required style="padding: 5px;" />
    <button type="submit" style="padding: 5px; background: #5a5aff; color: white;">ë¡œê·¸ì¸</button>
  </form>
</div>

          <div class="bottom-switch-row">
            <div class="language-dropdown">
              <button id="langToggle" class="lang-btn">
                <%
                  let flagCode = lang;
                  switch(lang) {
                    case 'ko': flagCode = 'kr'; break;
                    case 'en': flagCode = 'gb'; break;
                    case 'zh': flagCode = 'cn'; break;
                    case 'ja': flagCode = 'jp'; break;
                    case 'fr': flagCode = 'fr'; break;
                    default: flagCode = 'kr';
                  }
                %>
                <span class="fi fi-<%= flagCode %>"></span>
                <i class="fas fa-caret-down"></i>
              </button>
              <ul id="langMenu" class="lang-menu">
                <%
                  const currentPathWithoutLang = currentPath.replace(/^\/(ko|en|fr|zh|ja)/, '');
                %>
                <% supportedLangs.forEach(langCode => { %>
                  <li>
                    <a href="/<%= langCode %><%= currentPathWithoutLang %>"
                      class="lang-option <%= langCode === lang ? 'active-lang' : '' %>" style="color: white; padding: 5px 10px; display: block; text-decoration: none;">
                      <span class="fi fi-<%= (langCode === 'ko' ? 'kr' : (langCode === 'en' ? 'gb' : (langCode === 'zh' ? 'cn' : (langCode === 'ja' ? 'jp' : langCode)))) %>"></span>
                      <%= {ko: 'í•œêµ­ì–´', en: 'English', fr: 'FranÃ§ais', zh: 'ç®€ä½“ä¸­æ–‡', ja: 'æ—¥æœ¬èª'}[langCode] %>
                    </a>
                  </li>
                <% }); %>
              </ul>
            </div>

            <div class="light-switch" role="switch" aria-checked="false" aria-label="ë‹¤í¬ ëª¨ë“œ ì „í™˜" tabindex="0" id="mode-toggle-accessible">
              <span class="switch-label"><span class="switch-handle"></span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>
</div>

<script src="/assets/js/header.js"></script>
<script src="/assets/js/global.js"></script>

<script>
  document.getElementById('login').addEventListener('click', function () {
    const form = document.getElementById('login-form-container');
    form.style.display = (form.style.display === 'none') ? 'block' : 'none';
  });
</script>
