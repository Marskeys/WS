  <div class="full-header-container" style="z-index:20000;">
    <div class="header-top">
      <div class="top-controls">
        <div class="left-controls">
          <%
          const pathWithoutLang = currentPath.replace(/^\/(ko|en|fr|zh|ja)/, '');
          const showLogo = ['/signup', '/editor', '/login', '/write'].includes(pathWithoutLang) ||
                          pathWithoutLang.startsWith('/post') ||
                          pathWithoutLang.startsWith('/edit');
          %>
          <% if (showLogo) { %>
            <a href="/<%= lang %>/" class="logo-link">

            </a>
          <% } %>
        </div>
        <div class="right-controls">
          <div class="language-dropdown">
            <button id="langToggle" class="lang-btn">
              <%
                let flagCode = lang;
                switch(lang) {
                  case 'ko': flagCode = 'kr'; break;
                  case 'en': flagCode = 'gb'; break;
                  case 'zh': flagCode = 'cn'; break;
                  case 'ja': flagCode = 'jp'; break;
                  case 'fr': flagCode = 'fr'; break;
                  default: flagCode = 'kr';
                }
              %>
              <span class="fi fi-<%= flagCode %>"></span>
              <i class="fas fa-caret-down"></i>
            </button>
            <ul id="langMenu" class="lang-menu">
              <%
                const currentPathWithoutLang = currentPath.replace(/^\/(ko|en|fr|zh|ja)/, '');
              %>
              <% supportedLangs.forEach(langCode => { %>
                <li>
                  <a href="/<%= langCode %><%= currentPathWithoutLang %>"
                    class="lang-option <%= langCode === lang ? 'active-lang' : '' %>">
                    <span class="fi fi-<%= (langCode === 'ko' ? 'kr' : (langCode === 'en' ? 'gb' : (langCode === 'zh' ? 'cn' : (langCode === 'ja' ? 'jp' : langCode)))) %>"></span>
                    <%= {ko: 'í•œêµ­ì–´', en: 'English', fr: 'FranÃ§ais', zh: 'ç®€ä½“ä¸­æ–‡', ja: 'æ—¥æœ¬èª'}[langCode] %>
                  </a>
                </li>
              <% }); %>
            </ul>
          </div>

          <div class="light-switch" role="switch" aria-checked="false" aria-label="ë‹¤í¬ ëª¨ë“œ ì „í™˜" tabindex="0" id="mode-toggle-accessible">
            <span class="switch-label"><span class="switch-handle"></span></span>
          </div>
        </div>
      </div>
    </div>

    <aside class="side-panel main-panel-only">
      <div class="sidebar-wrapper">
        <nav class="vscode-sidebar">
              <a href="#" class="sidebar-icon toggle-extension" title="íŒ¨ë„ ì—´ê¸°/ë‹«ê¸°">
            <i class="fas fa-chevron-left"></i>
          </a>

          <a href="https://www.bugloop.dev" class="sidebar-icon active" data-tab="home" title="í™ˆ"><i class="fas fa-home"></i></a>

          <a href="#" class="sidebar-icon" data-tab="profile" title="í”„ë¡œí•„"><i class="fas fa-user"></i></a>
          <a href="#" class="sidebar-icon" data-tab="search" title="ê²€ìƒ‰"><i class="fas fa-search"></i></a>

          <% if (user) { %>
            <% if (Number(user.is_admin) === 1) { %>
              <a href="/<%= lang %>/write" class="sidebar-icon" data-tab="write" title="ê¸€ì“°ê¸°">
                <i class="fas fa-pen"></i>
              </a>
            <% } %>
            <a href="#" class="sidebar-icon" data-tab="settings" title="ì„¤ì •">
              <i class="fas fa-cog"></i>
            </a>
          <% } %>
        </nav>


        <div class="sidebar-extension-panel">
          <div>
            <div class="tab-content" data-tab="profile" style="display: none;">
              <div class="profile-tab">
                <img src="/assets/images/profile.gif" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" class="profile-avatar" />
                
                <div class="profile-info">
                  <h3 class="profile-name">ë§ˆì”¨ (Mr.Ma)</h3>
                  <p class="profile-bio">ì‚¬ì´ë²„ëŒ€ì—ì„œ ì»´í“¨í„°ê³µí•™ê³¼ ì •ë³´ë³´ì•ˆì„ ê³µë¶€í•˜ëŠ” ë§Œí•™ë„ê°€ ì›¹ ê°œë°œì˜ ë°”ë‹¤ì—ì„œ í—ˆìš°ì ëŒ€ëŠ” ë¸”ë¡œê·¸ğŸµ</p>
                  
                  <div class="profile-social">
                    <a href="" target="_blank"><i class="fab fa-instagram"></i></a>
                    <a href="" target="_blank"><i class="fab fa-github"></i></a>
                    <a href=""><i class="fas fa-envelope"></i></a>
                  </div>
            
                  <div class="profile-tags">
                    <span>#ì›¹ê°œë°œ</span>
                    <span>#ì‹œê°ì¥ì• ì¸</span>
                    <span>#ì‚¬ì´ë²„ëŒ€</span>
                    <span>#ìŒì•…</span>
                  </div>
                </div>
              </div>
            </div>

            <% if (typeof posts !== 'undefined') { %>
              <div class="tab-content" data-tab="search" style="display: none;">
                <%- include('table') %>
              </div>
            <% } %>


          </div>

          <div class="panel-footer">
            <% if (user) { %>
              <div class="greeting" style="text-align: center; margin-top: 10px; font-weight: bold;">
                <%= user.nickname %>ë‹˜, ì•ˆë…•í•˜ì„¸ìš”!
              </div>
            <% } %>
            <% if (currentPath !== '/signup' && currentPath !== '/login') { %>
              <div class="auth-buttons">
                <% if (user) { %>
                  <a href="/<%= lang %>/logout" class="auth-btn logout">ë¡œê·¸ì•„ì›ƒ</a>
                <% } else { %>
                  <a class="auth-btn signup" onclick="return false;" style="pointer-events: none; opacity: 0.5; cursor: not-allowed;">íšŒì›ê°€ì…</a>

                  <button class="auth-btn login" id="login" type="button">ë¡œê·¸ì¸</button>
                <% } %>
              </div>
            <% } %>
        
            <!-- ë¡œê·¸ì¸ í¼: ë¡œê·¸ì¸ ë²„íŠ¼ ëˆ„ë¥´ë©´ ë³´ì„ -->
            <div id="login-form-container" class="login-form-container hidden">
              <form id="login-form" method="POST" action="/login">
                <input type="text" name="id" placeholder="ì•„ì´ë””" required />
                <input type="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required />
                <button type="submit">ë¡œê·¸ì¸</button>
              </form>
            </div>
        
            <!-- ì§„ì§œ í‘¸í„° -->
            <div class="real-footer">
              <small>Â© 2025 Bug Loop</small>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <script src="/assets/js/header.js"></script>
  <script src="/assets/js/global.js"></script>

  <script>
    // ë¡œê·¸ì¸ ë²„íŠ¼ ëˆ„ë¥´ë©´ ë¡œê·¸ì¸ í¼ í† ê¸€
    document.getElementById('login')?.addEventListener('click', function () {
      const form = document.getElementById('login-form-container');
      const currentDisplay = window.getComputedStyle(form).display;
      form.style.display = (currentDisplay === 'none') ? 'block' : 'none';
    });
  
    document.addEventListener("DOMContentLoaded", () => {
      const isDesktop = window.innerWidth >= 768;
      const isHome =
        location.pathname === "/" ||
        /^\/(ko|en|fr|zh|ja)\/?$/.test(location.pathname);
  
      // âœ… ë°ìŠ¤í¬íƒ‘ì—ì„œ í™ˆì´ë©´ ìë™ìœ¼ë¡œ í”„ë¡œí•„ íƒ­ í´ë¦­
      if (isDesktop && isHome) {
        const profileIcon = document.querySelector('.sidebar-icon[data-tab="profile"]');
        if (profileIcon) {
          requestAnimationFrame(() => {
            setTimeout(() => {
              profileIcon.click();
            }, 0);
          });
        }
      }
  
      // âœ… ëª¨ë°”ì¼ì—ì„œ í™•ì¥í† ê¸€ ëˆ„ë¥´ë©´ ìë™ìœ¼ë¡œ í”„ë¡œí•„ íƒ­ í´ë¦­
      const toggleExtensionBtn = document.querySelector('.sidebar-icon.toggle-extension');
      const extensionPanel = document.querySelector('.sidebar-extension-panel');
  
      toggleExtensionBtn?.addEventListener('click', () => {
        const isMobile = window.innerWidth < 768;
        const isOpen = extensionPanel.classList.contains('open');
  
        if (!isOpen) {
          extensionPanel.classList.add('open');
          document.body.classList.add('panel-open');
  
          // íŒ¨ë„ ì—´ë¦´ ë•Œ í”„ë¡œí•„ íƒ­ í´ë¦­
          if (isMobile) {
            const profileIcon = document.querySelector('.sidebar-icon[data-tab="profile"]');
            if (profileIcon) {
              requestAnimationFrame(() => {
                setTimeout(() => {
                  profileIcon.click();
                }, 0);
              });
            }
          }
  
          const width = extensionPanel.getBoundingClientRect().width;
          document.documentElement.style.setProperty('--sidebar-width', `${width}px`);
        } else {
          extensionPanel.classList.remove('open');
          document.body.classList.remove('panel-open');
        }
      });
    });
  </script>