<div class="full-header-container">
  <div class="header-top">
    <div class="top-controls">
      <div class="left-controls">
        <%
        const pathWithoutLang = currentPath.replace(/^\/(ko|en|fr|zh|ja)/, '');
        const showLogo = ['/signup', '/editor', '/login', '/write'].includes(pathWithoutLang) ||
                        pathWithoutLang.startsWith('/post') ||
                        pathWithoutLang.startsWith('/edit');
        %>
        <% if (showLogo) { %>
          <a href="/<%= lang %>/" class="logo-link">

          </a>
        <% } %>
      </div>
      <div class="right-controls">
        <div class="language-dropdown">
          <button id="langToggle" class="lang-btn">
            <%
              let flagCode = lang;
              switch(lang) {
                case 'ko': flagCode = 'kr'; break;
                case 'en': flagCode = 'gb'; break;
                case 'zh': flagCode = 'cn'; break;
                case 'ja': flagCode = 'jp'; break;
                case 'fr': flagCode = 'fr'; break;
                default: flagCode = 'kr';
              }
            %>
            <span class="fi fi-<%= flagCode %>"></span>
            <i class="fas fa-caret-down"></i>
          </button>
          <ul id="langMenu" class="lang-menu">
            <%
              const currentPathWithoutLang = currentPath.replace(/^\/(ko|en|fr|zh|ja)/, '');
            %>
            <% supportedLangs.forEach(langCode => { %>
              <li>
                <a href="/<%= langCode %><%= currentPathWithoutLang %>"
                  class="lang-option <%= langCode === lang ? 'active-lang' : '' %>">
                  <span class="fi fi-<%= (langCode === 'ko' ? 'kr' : (langCode === 'en' ? 'gb' : (langCode === 'zh' ? 'cn' : (langCode === 'ja' ? 'jp' : langCode)))) %>"></span>
                  <%= {ko: '한국어', en: 'English', fr: 'Français', zh: '简体中文', ja: '日本語'}[langCode] %>
                </a>
              </li>
            <% }); %>
          </ul>
        </div>

        <div class="light-switch" role="switch" aria-checked="false" aria-label="다크 모드 전환" tabindex="0" id="mode-toggle-accessible">
          <span class="switch-label"><span class="switch-handle"></span></span>
        </div>
      </div>
    </div>
  </div>

  <aside class="side-panel main-panel-only">
    <div class="sidebar-wrapper">
   


      <div class="sidebar-extension-panel">
        <div>
          <div class="tab-content" data-tab="profile" style="display: none;">
            <div class="profile-tab">
              <img src="/assets/images/profile.gif" alt="프로필 이미지" class="profile-avatar" />
              
              <div class="profile-info">
                <h3 class="profile-name">마씨 (Mr.Ma)</h3>
                <p class="profile-bio">사이버대에서 컴퓨터공학과 정보보안을 공부하는 만학도가 웹 개발의 바다에서 허우적대는 블로그🎵</p>
                
                <div class="profile-social">
                  <a href="" target="_blank"><i class="fab fa-instagram"></i></a>
                  <a href="" target="_blank"><i class="fab fa-github"></i></a>
                  <a href=""><i class="fas fa-envelope"></i></a>
                </div>
          
                <div class="profile-tags">
                  <span>#웹개발</span>
                  <span>#시각장애인</span>
                  <span>#사이버대</span>
                  <span>#음악</span>
                </div>
              </div>
            </div>
          </div>

          <% if (typeof posts !== 'undefined') { %>
            <div class="tab-content" data-tab="search" style="display: none;">
              <%- include('table') %>
            </div>
          <% } %>


        </div>

        <div class="panel-footer">
          <% if (user) { %>
            <div class="greeting" style="text-align: center; margin-top: 10px; font-weight: bold;">
              <%= user.nickname %>님, 안녕하세요!
            </div>
          <% } %>
          <% if (currentPath !== '/signup' && currentPath !== '/login') { %>
            <div class="auth-buttons">
              <% if (user) { %>
                <a href="/<%= lang %>/logout" class="auth-btn logout">로그아웃</a>
              <% } else { %>
                <a class="auth-btn signup" onclick="return false;" style="pointer-events: none; opacity: 0.5; cursor: not-allowed;">회원가입</a>

                <button class="auth-btn login" id="login" type="button">로그인</button>
              <% } %>
            </div>
          <% } %>
      
          <!-- 로그인 폼: 로그인 버튼 누르면 보임 -->
          <div id="login-form-container" class="login-form-container hidden">
            <form id="login-form" method="POST" action="/login">
              <input type="text" name="id" placeholder="아이디" required />
              <input type="password" name="password" placeholder="비밀번호" required />
              <button type="submit">로그인</button>
            </form>
          </div>
      
          <!-- 진짜 푸터 -->
          <div class="real-footer">
            <small>© 2025 Bug Loop</small>
          </div>
        </div>
      </div>
    </div>
  </aside>
</div>

<script src="/assets/js/header.js"></script>
<script src="/assets/js/global.js"></script>

<script>
  // 로그인 버튼 누르면 로그인 폼 토글
  document.getElementById('login')?.addEventListener('click', function () {
    const form = document.getElementById('login-form-container');
    const currentDisplay = window.getComputedStyle(form).display;
    form.style.display = (currentDisplay === 'none') ? 'block' : 'none';
  });

  // ✅ DOMContentLoaded 후 홈에서 자동으로 프로필 탭 클릭하도록 안정적 처리
  document.addEventListener("DOMContentLoaded", () => {
    const isDesktop = window.innerWidth >= 768;
    const isHome =
      location.pathname === "/" ||
      /^\/(ko|en|fr|zh|ja)\/?$/.test(location.pathname);

    if (isDesktop && isHome) {
      const profileIcon = document.querySelector('.sidebar-icon[data-tab="profile"]');
      if (profileIcon) {
        // DOM 렌더 이후 이벤트 큐에서 실행되도록 요청 → 완전 안정
        requestAnimationFrame(() => {
          setTimeout(() => {
            profileIcon.click();
          }, 0);
        });
      }
    }
  });
</script>