<div class="full-header-container">
  <div class="header-top">
    <div class="top-controls">
      <div class="left-controls">
        <%
        const pathWithoutLang = currentPath.replace(/^\/(ko|en|fr|zh|ja)/, '');
        const showLogo = ['/signup', '/editor', '/login', '/write'].includes(pathWithoutLang) ||
                        pathWithoutLang.startsWith('/post') ||
                        pathWithoutLang.startsWith('/edit');
        %>
        <% if (showLogo) { %>
          <a href="/<%= lang %>/" class="logo-link">
            <img src="/assets/images/logo.png" alt="로고" class="floating-home-logo" />
          </a>
        <% } %>
      </div>
      <div class="right-controls"></div>
    </div>
    <nav class="mobile-menu" id="mobile-menu"></nav>

    <div id="loginBox" class="login-box" onclick="event.stopPropagation()">
      <form action="/login" method="POST" class="pop-up-form">
        <input type="text" name="id" placeholder="아이디" required>
        <input type="password" name="password" placeholder="비밀번호" required>
        <button type="submit">로그인</button>
        <div class="login-footer-links">
          <small>
            아직 회원이 아니세요? <a href="/<%= lang %>/signup">회원가입</a> <br>
            비밀번호가 기억나지 않으신다면? <a href="/<%= lang %>/reset-password">비밀번호 찾기</a>
          </small>
        </div>
      </form>
    </div>
  </div>

  <aside class="side-panel main-panel-only">
    <div class="sidebar-wrapper">
      <nav class="vscode-sidebar">
        <a href="#" class="sidebar-icon active" data-tab="home" title="홈"><i class="fas fa-home"></i></a>
        <a href="#" class="sidebar-icon" data-tab="search" title="검색"><i class="fas fa-search"></i></a>
        <a href="#" class="sidebar-icon" data-tab="write" title="글쓰기"><i class="fas fa-pen"></i></a>
        <a href="#" class="sidebar-icon" data-tab="settings" title="설정"><i class="fas fa-cog"></i></a>
      </nav>

      <!-- 패널 전체 구성: 내용 + 하단 고정 -->
      <div class="sidebar-extension-panel" style="display: flex; flex-direction: column; justify-content: space-between; height: 100%;">
        <!-- 상단 콘텐츠 스크롤 영역 -->
        <div style="flex-grow: 1; overflow-y: auto;">
          <div class="tab-content" data-tab="home">
            <h3>홈 패널</h3>
            <p>홈 관련 내용입니다.</p>
          </div>

          <div class="tab-content" data-tab="search" style="display: none;">
            <h3>검색</h3>
            <input type="text" placeholder="검색어를 입력하세요" style="width: 100%; padding: 5px;">
          </div>

          <div class="tab-content" data-tab="write" style="display: none;">
            <h3>글쓰기</h3>
            <button style="width: 100%;">새 글 작성</button>
          </div>

          <div class="tab-content" data-tab="settings" style="display: none;">
            <h3>설정</h3>
            <label><input type="checkbox"> 다크 모드</label>
          </div>

          <!-- 언어 선택 -->
          <div class="language-dropdown" style="padding: 10px; border-top: 1px solid #333; margin-top: 10px;">
            <button id="langToggle" class="lang-btn" style="width: 100%; justify-content: space-between; display: flex; align-items: center; background: none; border: none; color: white; cursor: pointer; padding: 5px 0;">
              <%
                let flagCode = lang;
                switch(lang) {
                  case 'ko': flagCode = 'kr'; break;
                  case 'en': flagCode = 'gb'; break;
                  case 'zh': flagCode = 'cn'; break;
                  case 'ja': flagCode = 'jp'; break;
                  case 'fr': flagCode = 'fr'; break;
                  default: flagCode = 'kr';
                }
              %>
              <span class="fi fi-<%= flagCode %>"></span>
              <i class="fas fa-caret-down"></i>
            </button>
            <ul id="langMenu" class="lang-menu" style="position: static; display: none; background: #444; border: none; box-shadow: none; padding: 5px 0;">
              <%
                const currentPathWithoutLang = currentPath.replace(/^\/(ko|en|fr|zh|ja)/, '');
              %>
              <% supportedLangs.forEach(langCode => { %>
                <li>
                  <a href="/<%= langCode %><%= currentPathWithoutLang %>"
                    class="lang-option <%= langCode === lang ? 'active-lang' : '' %>" style="color: white; padding: 5px 10px; display: block; text-decoration: none;">
                    <span class="fi fi-<%= (langCode === 'ko' ? 'kr' : (langCode === 'en' ? 'gb' : (langCode === 'zh' ? 'cn' : (langCode === 'ja' ? 'jp' : langCode)))) %>"></span>
                    <%= {ko: '한국어', en: 'English', fr: 'Français', zh: '简体中文', ja: '日本語'}[langCode] %>
                  </a>
                </li>
              <% }); %>
            </ul>
          </div>
        </div>

        <!-- 하단 고정 영역 -->
        <div style="border-top: 1px solid #444; padding: 10px;">
          <% if (currentPath !== '/signup' && currentPath !== '/login') { %>
            <div class="auth-buttons" style="display: flex; flex-direction: column; gap: 10px;">
              <% if (user) { %>
                <% if (Number(user.is_admin) === 1) { %>
                  <span class="welcome-text" style="font-size: 0.85rem; color: #aaa; text-align: center;"><strong><%= user.nickname %></strong>님 안녕하세요!</span>
                  <a href="/<%= lang %>/write" class="auth-btn write-post" style="width: 100%; text-align: center;"> <i class="fas fa-pen"></i> 글쓰기</a>
                <% } %>
                <a href="/<%= lang %>/logout" class="auth-btn logout" style="width: 100%; text-align: center;">로그아웃</a>
              <% } else { %>
                <a class="auth-btn signup" onclick="delayNavigation(event, '/<%= lang %>/signup')" style="width: 100%; text-align: center;">회원가입</a>
                <button class="auth-btn login" id="login" type="button" style="width: 100%; text-align: center;">로그인</button>
              <% } %>
            </div>
          <% } %>

          <div class="light-switch"
            role="switch"
            aria-checked="false"
            aria-label="다크 모드 전환"
            tabindex="0"
            id="mode-toggle-accessible"
            style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px; cursor: pointer; color: white;">
            <span>다크 모드</span>
            <span class="switch-label"><span class="switch-handle"></span></span>
          </div>
        </div>
      </div>
    </div>
  </aside>
</div>

<script src="/assets/js/header.js"></script>
