<head>
  <!-- ðŸŒ™ ë‹¤í¬ëª¨ë“œ ì´ˆê¸°í™” (í•„ìˆ˜) -->
  <script>
    (function() {
      try {
        const THEME_KEY = 'bugloop.theme';
        const htmlEl = document.documentElement;
        const saved = localStorage.getItem(THEME_KEY);
        const theme =
          saved ||
          (window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'dark'
            : 'light');
        if (theme === 'dark') htmlEl.classList.add('dark');
        else htmlEl.classList.remove('dark');
      } catch (e) {
        console.warn('Theme initialization failed:', e);
      }
    })();
  </script>

  <!-- ðŸ”¤ Basic -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <%
    const desc =
      (chapter && chapter.description)
        ? chapter.description
        : `${book.title} â€” ${chapter.title} (ì „ìžì±… ì±•í„°)`;
    const pageUrl =
      `https://bugloop.dev/${lang}/books/${bookId}/contents/${chapter.id}`;
  %>

  <!-- ðŸ“˜ Title / Description -->
  <title><%= chapter.title %> â€“ <%= book.title %></title>
  <meta name="description" content="<%= desc %>" />

  <!-- ðŸ”— Canonical -->
  <link rel="canonical" href="<%= pageUrl %>" />

  <!-- ðŸŒ hreflang (ì „ìžì±… ì±•í„° ì „ìš©) -->
  <% supportedLangs.forEach(l => { %>
    <link
      rel="alternate"
      hreflang="<%= l %>"
      href="https://bugloop.dev/<%= l %>/books/<%= bookId %>/contents/<%= chapter.id %>"
    />
  <% }) %>
  <link
    rel="alternate"
    hreflang="x-default"
    href="https://bugloop.dev/books/<%= bookId %>/contents/<%= chapter.id %>"
  />

  <!-- ðŸ¤– Robots -->
  <meta name="robots" content="index,follow" />

  <!-- ðŸ”Ž Open Graph -->
  <meta property="og:type" content="article" />
  <meta property="og:title" content="<%= chapter.title %> â€“ <%= book.title %>" />
  <meta property="og:description" content="<%= desc %>" />
  <meta property="og:url" content="<%= pageUrl %>" />

  <!-- ðŸŽ¨ Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Noto+Sans+KR:wght@400;700&family=Noto+Serif+KR&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Asta+Sans:wght@100..900&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css"
  />

  <!-- ðŸŽ¨ Global UI CSS (ì ˆëŒ€ ì œê±° âŒ) -->
  <link rel="stylesheet" href="/assets/css/header.css" />
  <link rel="stylesheet" href="/assets/css/style.css" />
  <link rel="stylesheet" href="/assets/css/table.css" />
  <link rel="stylesheet" href="/assets/css/darkmode.css" />

  <!-- ðŸŽ¨ E-Reader CSS -->
  <link rel="stylesheet" href="/assets/css/e-reader.css" />

  <!-- ðŸ”” Icons -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/flag-icons@6.6.6/css/flag-icons.min.css"
  />

  <!-- ðŸ§© Utility -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.0/beautify-html.min.js"></script>
</head>
