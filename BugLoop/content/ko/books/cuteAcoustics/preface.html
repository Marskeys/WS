<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>귀여운 음향학 서문</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    /* ... (기존 CSS 스타일 유지) ... */
    body {
      margin: 0;
      font-family: "Noto Serif KR", serif;
      background: #f5f5f5;
      overflow: hidden; /* 스크롤 완전 금지 */
      transition: background 0.3s, color 0.3s; /* 다크모드 전환 시 부드럽게 */
    }

    body.dark {
      background: #121212;
      color: #f5f5f5;
    }

    .viewer {
      position: relative;
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .page {
      width: 80%;
      max-width: 800px;
      height: 90vh;
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      line-height: 1.8;
      font-size: 16px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    body.dark .page {
      background: #333;
      color: #f5f5f5;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }

    h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }

    h2 {
      font-size: 20px;
      color: #666;
      margin-top: 0;
    }
    
    body.dark h2 {
      color: #bbb;
    }

    .page-text {
      flex: 1;
      overflow: hidden;
      white-space: pre-wrap;
    }

    .page-index {
      text-align: right;
      color: #aaa;
      font-size: 14px;
    }

    .nav-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: #333;
      color: white;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 22px;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.3s, background 0.3s;
      z-index: 10;
    }
    
    body.dark .nav-btn {
        background: #555;
    }

    .nav-btn:hover {
      opacity: 1;
    }

    #prevBtn { left: 30px; }
    #nextBtn { right: 30px; }
    
    /* 상단 버튼 공통 스타일 */
    .top-btn {
        position: absolute;
        top: 30px;
        background: #0066ff; /* 버튼 배경색 통일 */
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 14px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s, opacity 0.3s;
        z-index: 10;
        /* 아이콘 버튼의 텍스트가 없어졌으므로 패딩 조정 가능 */
        /* padding: 10px; */ 
    }
    /* 아이콘에만 적용되는 스타일 */
    .top-btn i {
        margin-right: 5px; /* 아이콘과 텍스트 사이 간격 */
    }
    /* 텍스트가 없는 버튼을 위해 padding 조정 */
    #homeBtn, #darkModeToggle, #tocToggle {
        padding: 10px; /* 아이콘만 있을 때 더 정사각형에 가깝게 */
    }


    .top-btn:hover {
        background: #0055e6;
    }

    body.dark .top-btn {
        background: #4a90e2;
    }
    
    body.dark .top-btn:hover {
        background: #5b9ce6;
    }

    /* 홈 버튼 위치 */
    #homeBtn { left: 30px; }

    /* 다크모드/목차 버튼 위치 */
    #darkModeToggle { right: 85px; } /* 버튼 크기가 작아졌으므로 간격 재조정 */
    #tocToggle { right: 30px; } /* 기존 위치 유지 */

    .toc {
      position: absolute;
      top: 0;
      right: -300px; /* 목차 너비만큼 오른쪽으로 이동시켜 숨김 */
      width: 300px;
      height: 100%;
      background: #222;
      color: white;
      transition: right 0.3s ease;
      overflow-y: auto;
      padding: 20px;
      z-index: 20;
    }

    .toc.open {
      right: 0;
    }

    .toc h3 {
      margin-top: 0;
    }

    .toc li {
      margin: 12px 0;
      cursor: pointer;
      color: #bbb;
    }

    .toc li:hover {
      color: white;
    }

    @media (max-width: 768px) {
      .page {
        width: 95%;
        padding: 20px;
      }

      .nav-btn {
        font-size: 18px;
        width: 40px;
        height: 40px;
      }
      
      .top-btn {
        padding: 8px; /* 아이콘 버튼에 맞게 조정 */
        font-size: 16px; /* 아이콘이므로 폰트 크기 조정 */
        top: 15px;
      }
      
      #homeBtn { left: 15px; }
      #darkModeToggle { right: 70px; } /* 버튼 크기에 맞게 조정 */
      #tocToggle { right: 15px; }
    }
  </style>
</head>
<body>

  <div class="viewer">
    <button id="prevBtn" class="nav-btn">〈</button>
    <button id="nextBtn" class="nav-btn">〉</button>
    
    <button id="homeBtn" class="top-btn" title="홈으로 이동"><i class="fas fa-home"></i></button>
    
    <button id="darkModeToggle" class="top-btn" title="테마 전환"><i class="fas fa-moon"></i></button>
    
    <button id="tocToggle" class="top-btn" title="목차 보기"><i class="fas fa-list"></i></button>

    <div class="page" id="page">
      <div class="page-text" id="pageText"></div>
      <div class="page-index" id="pageIndex"></div>
    </div>

    <div class="toc" id="toc">
      <h3>목차</h3>
      <ul id="tocList"></ul>
    </div>
  </div>

  <script>
    const book = {
      title: "귀여운 음향학 서문",
      subtitle: "(일러스트: 우리 음향학은 안 물어요!)",
      body: `‘소리’는 공기의 미세한 진동을 귀로 감지한 것을 말합니다. 넓은 의미에서는 귀로 들을 수 없는 순수한 진동 자체도 소리의 범주에 넣기도 합니다. 예를 들어, ‘초음파’는 그 진동이 너무 빨라 인간의 귀로는 음의 높낮이를 인식할 수 없지만, 공간을 통해 퍼져나가는 물리적인 진동이라는 본질적인 특성은 일반적인 소리와 정확히 같기 때문에 소리의 일종으로 봅니다. 이는 마치 자외선이나 적외선을 우리가 눈으로 볼 수는 없지만, 여전히 공간을 퍼져나가는 전자기적인 진동이라는 측면에서 빨주노초파남보의 가시광선과 같은 ‘빛’으로 취급하는 것과도 같습니다.

눈으로 볼 수 있는 파장 범위의 빛을 가시광선(visible light)이라고 부르듯, 귀로 들을 수 있는 주파수 범위의 소리를 가청음(audible sound)이라고 합니다. 인간의 감각기관이 인지할 수 있는 외부 자극은 실제로 존재하는 자극의 극히 일부에 불과합니다.`
    };

    const charsPerPage = 1200; // 한 페이지당 글자 수
    const pages = [];
    for (let i = 0; i < book.body.length; i += charsPerPage) {
      pages.push(book.body.slice(i, i + charsPerPage));
    }

    let currentPage = 0;
    const pageText = document.getElementById("pageText");
    const pageIndex = document.getElementById("pageIndex");
    const tocEl = document.getElementById("toc");
    const bodyEl = document.body;
    const darkModeToggle = document.getElementById("darkModeToggle");
    const darkModeIcon = darkModeToggle.querySelector('i'); // 아이콘 요소 선택
    
    // 로컬 저장소에서 설정 불러오기
    const initialDarkMode = localStorage.getItem('darkMode') === 'true';

    // 다크 모드 상태를 설정하고 버튼 아이콘을 업데이트하는 함수
    function setDarkMode(isDark) {
        if (isDark) {
            bodyEl.classList.add("dark");
            // 달 아이콘 -> 해 아이콘으로 변경
            darkModeIcon.classList.remove("fa-moon");
            darkModeIcon.classList.add("fa-sun");
            localStorage.setItem('darkMode', 'true');
        } else {
            bodyEl.classList.remove("dark");
            // 해 아이콘 -> 달 아이콘으로 변경
            darkModeIcon.classList.remove("fa-sun");
            darkModeIcon.classList.add("fa-moon");
            localStorage.setItem('darkMode', 'false');
        }
    }
    
    // 초기 모드 설정 
    setDarkMode(initialDarkMode);

    function renderPage() {
      const header = `<h1>${book.title}</h1><h2>${book.subtitle}</h2>`;
      pageText.innerHTML = header + "<p>" + pages[currentPage] + "</p>";
      pageIndex.innerText = `${currentPage + 1} / ${pages.length}`;
    }

    function renderTOC() {
      const tocList = document.getElementById("tocList");
      tocList.innerHTML = `<li onclick="goTo(0)">귀여운 음향학 서문</li>`;
    }

    function goTo(i) {
      currentPage = i;
      renderPage();
      tocEl.classList.remove("open");
    }

    document.getElementById("nextBtn").onclick = () => {
      if (currentPage < pages.length - 1) {
        currentPage++;
        renderPage();
      }
    };
    document.getElementById("prevBtn").onclick = () => {
      if (currentPage > 0) {
        currentPage--;
        renderPage();
      }
    };
    document.getElementById("tocToggle").onclick = () => {
      tocEl.classList.toggle("open");
    };
    document.getElementById("homeBtn").onclick = () => {
      window.location.href = "/"; // 홈으로 이동
    };
    
    // 다크 모드 토글 이벤트 리스너
    darkModeToggle.onclick = () => {
        const isDark = !bodyEl.classList.contains("dark");
        setDarkMode(isDark);
    };

    renderTOC();
    renderPage();

    // 모바일에서 슬라이드로 페이지 넘어가기
    let touchStartX = 0;
    let touchEndX = 0;
    
    document.body.addEventListener("touchstart", (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });
    
    document.body.addEventListener("touchend", (e) => {
      touchEndX = e.changedTouches[0].screenX;
      if (touchStartX - touchEndX > 50) {
        if (currentPage < pages.length - 1) {
          currentPage++;
          renderPage();
        }
      } else if (touchEndX - touchStartX > 50) {
        if (currentPage > 0) {
          currentPage--;
          renderPage();
        }
      }
    });
  </script>

</body>
</html>